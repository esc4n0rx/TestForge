{
  "title": "API de Autenticação - TestForge",
  "version": "1.0.0",
  "baseUrl": "/api/auth",
  "description": "Documentação completa dos endpoints de autenticação do sistema TestForge",
  "endpoints": [
    {
      "name": "Cadastro de Usuário",
      "method": "POST",
      "path": "/register",
      "description": "Cria uma nova conta de usuário no sistema",
      "rateLimit": "3 requisições por hora",
      "authentication": "Não requerida",
      "requestBody": {
        "content-type": "application/json",
        "schema": {
          "email": {
            "type": "string",
            "format": "email",
            "required": true,
            "description": "Email único do usuário"
          },
          "nome": {
            "type": "string",
            "minLength": 2,
            "required": true,
            "description": "Nome completo do usuário"
          },
          "senha": {
            "type": "string",
            "minLength": 8,
            "required": true,
            "description": "Senha do usuário (será armazenada com hash bcrypt)"
          },
          "empresa": {
            "type": "string",
            "minLength": 2,
            "required": true,
            "description": "Nome da empresa do usuário"
          }
        },
        "example": {
          "email": "usuario@exemplo.com",
          "nome": "João Silva",
          "senha": "senhaForte123",
          "empresa": "Empresa LTDA"
        }
      },
      "responses": {
        "201": {
          "description": "Usuário criado com sucesso e sessão iniciada",
          "example": {
            "success": true,
            "data": {
              "user": {
                "id": 1,
                "email": "usuario@exemplo.com",
                "nome": "João Silva",
                "empresa": "Empresa LTDA",
                "createdAt": "2024-01-08T12:00:00.000Z",
                "updatedAt": "2024-01-08T12:00:00.000Z"
              },
              "message": "Usuário cadastrado com sucesso"
            }
          }
        },
        "400": {
          "description": "Dados inválidos",
          "example": {
            "success": false,
            "error": {
              "message": "Dados inválidos",
              "code": "VALIDATION_ERROR",
              "details": [
                {
                  "field": "email",
                  "message": "Email inválido"
                }
              ]
            }
          }
        },
        "409": {
          "description": "Email já cadastrado",
          "example": {
            "success": false,
            "error": {
              "message": "Este email já está cadastrado",
              "code": "EMAIL_ALREADY_EXISTS"
            }
          }
        },
        "429": {
          "description": "Limite de requisições excedido",
          "example": {
            "success": false,
            "error": {
              "message": "Muitas tentativas de cadastro. Tente novamente em 1 hora.",
              "code": "TOO_MANY_REQUESTS"
            }
          }
        }
      }
    },
    {
      "name": "Login",
      "method": "POST",
      "path": "/login",
      "description": "Autentica um usuário e cria uma sessão",
      "rateLimit": "5 tentativas por 15 minutos (apenas falhas contam)",
      "authentication": "Não requerida",
      "requestBody": {
        "content-type": "application/json",
        "schema": {
          "email": {
            "type": "string",
            "format": "email",
            "required": true,
            "description": "Email do usuário"
          },
          "senha": {
            "type": "string",
            "required": true,
            "description": "Senha do usuário"
          }
        },
        "example": {
          "email": "usuario@exemplo.com",
          "senha": "senhaForte123"
        }
      },
      "responses": {
        "200": {
          "description": "Login realizado com sucesso",
          "example": {
            "success": true,
            "data": {
              "user": {
                "id": 1,
                "email": "usuario@exemplo.com",
                "nome": "João Silva",
                "empresa": "Empresa LTDA",
                "createdAt": "2024-01-08T12:00:00.000Z",
                "updatedAt": "2024-01-08T12:00:00.000Z"
              },
              "message": "Login realizado com sucesso"
            }
          }
        },
        "400": {
          "description": "Dados inválidos",
          "example": {
            "success": false,
            "error": {
              "message": "Dados inválidos",
              "code": "VALIDATION_ERROR",
              "details": [
                {
                  "field": "email",
                  "message": "Email inválido"
                }
              ]
            }
          }
        },
        "401": {
          "description": "Credenciais inválidas",
          "example": {
            "success": false,
            "error": {
              "message": "Email ou senha inválidos",
              "code": "INVALID_CREDENTIALS"
            }
          }
        },
        "429": {
          "description": "Limite de requisições excedido",
          "example": {
            "success": false,
            "error": {
              "message": "Muitas tentativas de login. Tente novamente em 15 minutos.",
              "code": "TOO_MANY_REQUESTS"
            }
          }
        }
      }
    },
    {
      "name": "Logout",
      "method": "POST",
      "path": "/logout",
      "description": "Encerra a sessão do usuário autenticado",
      "rateLimit": "Não aplicado",
      "authentication": "Requerida (sessão ativa)",
      "requestBody": null,
      "responses": {
        "200": {
          "description": "Logout realizado com sucesso",
          "example": {
            "success": true,
            "data": {
              "message": "Logout realizado com sucesso"
            }
          }
        },
        "401": {
          "description": "Usuário não autenticado",
          "example": {
            "success": false,
            "error": {
              "message": "Autenticação necessária",
              "code": "UNAUTHORIZED"
            }
          }
        }
      }
    },
    {
      "name": "Solicitar Reset de Senha",
      "method": "POST",
      "path": "/forgot-password",
      "description": "Solicita um link de recuperação de senha via email",
      "rateLimit": "3 requisições por hora",
      "authentication": "Não requerida",
      "requestBody": {
        "content-type": "application/json",
        "schema": {
          "email": {
            "type": "string",
            "format": "email",
            "required": true,
            "description": "Email do usuário que esqueceu a senha"
          }
        },
        "example": {
          "email": "usuario@exemplo.com"
        }
      },
      "responses": {
        "200": {
          "description": "Solicitação processada (resposta genérica por segurança)",
          "example": {
            "success": true,
            "data": {
              "message": "Se o email existir, um link de recuperação será enviado"
            }
          },
          "notes": "A resposta é sempre a mesma, independente do email existir ou não, para evitar enumeração de usuários"
        },
        "400": {
          "description": "Dados inválidos",
          "example": {
            "success": false,
            "error": {
              "message": "Dados inválidos",
              "code": "VALIDATION_ERROR",
              "details": [
                {
                  "field": "email",
                  "message": "Email inválido"
                }
              ]
            }
          }
        },
        "429": {
          "description": "Limite de requisições excedido",
          "example": {
            "success": false,
            "error": {
              "message": "Muitas solicitações de reset de senha. Tente novamente em 1 hora.",
              "code": "TOO_MANY_REQUESTS"
            }
          }
        }
      },
      "emailDetails": {
        "provider": "Resend",
        "template": "HTML profissional com botão de ação",
        "tokenExpiration": "1 hora",
        "linkFormat": "${FRONTEND_URL}/reset-password?token={token}"
      }
    },
    {
      "name": "Redefinir Senha",
      "method": "POST",
      "path": "/reset-password",
      "description": "Redefine a senha do usuário usando um token válido",
      "rateLimit": "Não aplicado",
      "authentication": "Não requerida (autenticação via token)",
      "requestBody": {
        "content-type": "application/json",
        "schema": {
          "token": {
            "type": "string",
            "required": true,
            "description": "Token de reset recebido por email"
          },
          "newPassword": {
            "type": "string",
            "minLength": 8,
            "required": true,
            "description": "Nova senha do usuário"
          }
        },
        "example": {
          "token": "abc123def456...",
          "newPassword": "novaSenhaForte456"
        }
      },
      "responses": {
        "200": {
          "description": "Senha redefinida com sucesso",
          "example": {
            "success": true,
            "data": {
              "message": "Senha redefinida com sucesso"
            }
          }
        },
        "400": {
          "description": "Token inválido, expirado ou já usado",
          "examples": [
            {
              "case": "Token inválido",
              "response": {
                "success": false,
                "error": {
                  "message": "Token inválido",
                  "code": "INVALID_TOKEN"
                }
              }
            },
            {
              "case": "Token expirado",
              "response": {
                "success": false,
                "error": {
                  "message": "Token expirado",
                  "code": "TOKEN_EXPIRED"
                }
              }
            },
            {
              "case": "Token já usado",
              "response": {
                "success": false,
                "error": {
                  "message": "Este token já foi utilizado",
                  "code": "TOKEN_ALREADY_USED"
                }
              }
            }
          ]
        }
      },
      "notes": "Tokens antigos do mesmo usuário são invalidados automaticamente quando um novo é gerado"
    },
    {
      "name": "Obter Dados do Usuário Autenticado",
      "method": "GET",
      "path": "/me",
      "description": "Retorna os dados do usuário atualmente autenticado",
      "rateLimit": "Não aplicado",
      "authentication": "Requerida (sessão ativa)",
      "requestBody": null,
      "responses": {
        "200": {
          "description": "Dados do usuário retornados com sucesso",
          "example": {
            "success": true,
            "data": {
              "user": {
                "id": 1,
                "email": "usuario@exemplo.com",
                "nome": "João Silva",
                "empresa": "Empresa LTDA",
                "createdAt": "2024-01-08T12:00:00.000Z",
                "updatedAt": "2024-01-08T12:00:00.000Z"
              }
            }
          }
        },
        "401": {
          "description": "Usuário não autenticado",
          "example": {
            "success": false,
            "error": {
              "message": "Autenticação necessária",
              "code": "UNAUTHORIZED"
            }
          }
        }
      }
    }
  ],
  "sessionDetails": {
    "type": "Sessão baseada em Redis",
    "cookieName": "testforge.sid",
    "duration": "7 dias",
    "storage": "Redis",
    "secure": "true em produção, false em desenvolvimento",
    "httpOnly": true,
    "sameSite": "strict"
  },
  "securityFeatures": {
    "passwordHashing": "bcrypt com 12 rounds",
    "rateLimiting": {
      "login": "5 tentativas por 15 minutos (apenas falhas)",
      "register": "3 cadastros por hora",
      "passwordReset": "3 solicitações por hora"
    },
    "tokenGeneration": "crypto.randomBytes(32).toString('hex')",
    "tokenExpiration": "1 hora",
    "sessionStorage": "Redis com cookies seguros"
  },
  "notes": [
    "Todas as respostas seguem o padrão: { success: boolean, data?: object, error?: object }",
    "Senhas nunca são retornadas nas respostas da API",
    "Tokens de reset são invalidados após uso ou expiração",
    "Rate limiting protege contra ataques de força bruta",
    "Emails de reset são sempre enviados via Resend com template HTML profissional"
  ]
}
